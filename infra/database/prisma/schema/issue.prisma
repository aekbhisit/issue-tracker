// Issue Collector Models

model Issue {
  id            Int               @id @default(autoincrement())
  projectId     Int               @map("project_id")
  title         String
  description   String?
  severity      String            // low, medium, high, critical
  status        String            @default("open") // open, in-progress, resolved, closed
  assigneeId    Int?              @map("assignee_id")
  reporterInfo  Json?             @map("reporter_info")
  metadata      Json?
  createdAt     DateTime          @default(now()) @map("created_at")
  updatedAt     DateTime          @updatedAt @map("updated_at")
  project       Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee      User?             @relation(fields: [assigneeId], references: [id])
  screenshots   IssueScreenshot[]
  logs          IssueLog[]
  comments      IssueComment[]
  
  @@index([projectId])
  @@index([status])
  @@index([severity])
  @@index([createdAt])
  @@map("issues")
}

model IssueScreenshot {
  id            Int      @id @default(autoincrement())
  issueId       Int      @map("issue_id")
  storagePath   String   @map("storage_path")
  storageType   String   @map("storage_type") // local, s3
  mimeType      String?  @map("mime_type")
  width         Int?
  height        Int?
  fileSize      Int?     @map("file_size")
  elementSelector Json?   @map("element_selector") // JSON object with cssSelector, xpath, boundingBox, outerHTML
  createdAt     DateTime @default(now()) @map("created_at")
  issue         Issue    @relation(fields: [issueId], references: [id], onDelete: Cascade)
  
  @@index([issueId])
  @@map("issue_screenshots")
}

model IssueLog {
  id        Int      @id @default(autoincrement())
  issueId   Int      @map("issue_id")
  logType   String   @map("log_type") // console, error, network
  level     String?  // log, warn, error (for console logs)
  message   String
  stack     String?
  metadata  Json?    // Additional log data (url, method, status for network errors, etc.)
  timestamp DateTime
  createdAt DateTime @default(now()) @map("created_at")
  issue     Issue    @relation(fields: [issueId], references: [id], onDelete: Cascade)
  
  @@index([issueId])
  @@index([logType])
  @@index([level])
  @@map("issue_logs")
}

model IssueComment {
  id        Int      @id @default(autoincrement())
  issueId   Int      @map("issue_id")
  userId    Int      @map("user_id")
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  issue     Issue    @relation(fields: [issueId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
  
  @@index([issueId])
  @@index([userId])
  @@map("issue_comments")
}

