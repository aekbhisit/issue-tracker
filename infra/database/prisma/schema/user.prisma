// User Management Models

model User {
  id            Int       @id @default(autoincrement())
  roleId        Int?      @map("role_id")
  name          String?
  username      String?   @unique
  email         String?   @unique
  password      String
  avatar        String?
  lang          String    @default("en")
  loginAt       DateTime? @map("login_at")
  status        Boolean   @default(false)
  rememberToken String?   @map("remember_token")
  deletedAt     DateTime? @map("deleted_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  role          UserRole? @relation(fields: [roleId], references: [id])
  activityLogs  ActivityLog[]
  assignedIssues Issue[]  // Issues assigned to this user
  issueComments IssueComment[]

  @@index([roleId])
  @@index([username])
  @@index([email])
  @@index([status])
  @@index([deletedAt])
  @@map("user_users")
}

model UserRole {
  id              Int              @id @default(autoincrement())
  name            String
  scope           String           @default("admin") // "admin" | "member"
  sequence        Int              @default(0)
  status          Boolean          @default(true)
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  rolePermissions RolePermission[]
  users           User[]

  @@index([scope])
  @@index([scope, sequence])
  @@index([scope, status])
  @@index([status])
  @@index([sequence])
  @@map("user_roles")
}

model Permission {
  id              Int              @id(map: "permissions_pkey") @default(autoincrement())
  scope           String           @default("admin") // "admin" | "member" | "public"
  method          String
  module          String
  type            String?          @map("type")
  group           String
  action          String
  path            String
  metaName        String           @map("meta_name")
  description     String
  isActive        Boolean          @default(true) @map("is_active")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  rolePermissions RolePermission[]

  @@unique([scope, method, type, path], map: "permissions_scope_method_type_path_key")
  @@unique([scope, metaName], map: "permissions_scope_meta_name_key")
  @@index([scope], map: "permissions_scope_idx")
  @@index([scope, module], map: "permissions_scope_module_idx")
  @@index([scope, isActive], map: "permissions_scope_is_active_idx")
  @@index([isActive], map: "permissions_is_active_idx")
  @@index([module], map: "permissions_module_idx")
  @@map("user_permissions")
}

model RolePermission {
  roleId       Int        @map("role_id")
  permissionId Int        @map("permission_id")
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade, map: "role_permissions_permission_id_fkey")
  role         UserRole   @relation(fields: [roleId], references: [id], onDelete: Cascade, map: "role_permissions_role_id_fkey")

  @@id([roleId, permissionId], map: "role_permissions_pkey")
  @@index([permissionId], map: "role_permissions_permission_id_idx")
  @@index([roleId], map: "role_permissions_role_id_idx")
  @@map("user_roles_permissions")
}
